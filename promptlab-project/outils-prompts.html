<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptLab - Outils de Prompts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hidden { display: none; }
        .block { display: block; }
        .accordion-header { cursor: pointer; user-select: none; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .accordion-content.active { max-height: 500px; transition: max-height 0.5s ease-in; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-800 to-purple-900 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-4xl bg-white bg-opacity-15 backdrop-filter backdrop-blur-lg rounded-3xl shadow-2xl p-8 md:p-10 flex flex-col items-center">
        <nav class="w-full mb-8 flex justify-center space-x-4">
            <a href="index.html" class="py-2 px-4 rounded-full bg-gray-700 hover:bg-gray-600 text-white font-semibold transition-colors duration-200">Accueil</a>
            <a href="generateur-image.html" class="py-2 px-4 rounded-full bg-gray-700 hover:bg-gray-600 text-white font-semibold transition-colors duration-200">G√©n√©rateur</a>
            <a href="outils-prompts.html" class="py-2 px-4 rounded-full bg-pink-600 text-white font-semibold">Outils</a>
            <a href="profil-statistiques.html" class="py-2 px-4 rounded-full bg-gray-700 hover:bg-gray-600 text-white font-semibold transition-colors duration-200">Profil & Stats</a>
            <a href="modules-apprentissage.html" class="py-2 px-4 rounded-full bg-gray-700 hover:bg-gray-600 text-white font-semibold transition-colors duration-200">Modules</a>
        </nav>

        <h1 class="text-4xl md:text-5xl font-extrabold text-center text-white mb-6 leading-tight">
            üõ†Ô∏è Outils de Prompts
            <span class="block text-2xl md:text-3xl font-semibold opacity-80 mt-2">
                Boostez votre cr√©ativit√© et votre pr√©cision
            </span>
        </h1>

        <p class="text-lg text-center text-white mb-8 opacity-90">
            Explorez les diff√©rentes fa√ßons d'am√©liorer, d'analyser et d'optimiser vos prompts pour des r√©sultats IA exceptionnels.
        </p>

        <div class="w-full mb-10 bg-white bg-opacity-20 rounded-2xl p-6 shadow-xl border border-white border-opacity-20">
            <h2 class="text-3xl font-bold text-center text-white mb-6">G√©n√©rer des Id√©es de Prompts ‚ú®</h2>
            <p class="text-lg text-center text-white mb-4 opacity-90">
                Entrez un th√®me pour obtenir des suggestions de prompts cr√©atifs.
            </p>
            <input
                type="text"
                id="ideaThemeInput"
                class="w-full p-4 rounded-xl bg-gray-700 bg-opacity-60 text-white placeholder-gray-300 focus:outline-none focus:ring-4 focus:ring-green-400 mb-6 text-lg"
                placeholder="Ex: Fantaisie m√©di√©vale, science-fiction, animaux mignons"
            />
            <button
                id="generateIdeasButton"
                class="w-full py-4 px-8 rounded-full bg-green-600 hover:bg-green-700 text-white text-2xl font-bold shadow-xl transition-all duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
                Sugg√©rer des Id√©es ‚ú®
            </button>
            <div id="ideasResultContainer" class="mt-8 p-4 bg-gray-700 bg-opacity-40 rounded-lg text-white hidden">
                <h3 class="text-xl font-semibold mb-4">Id√©es de Prompts : </h3>
                <ul id="ideasList" class="list-disc list-inside space-y-2">
                    </ul>
            </div>
             <div id="ideasErrorMessage" class="mt-8 p-4 bg-red-700 bg-opacity-80 rounded-lg text-center font-medium text-lg text-white shadow-md hidden">
                </div>
        </div>

        <div class="w-full mb-10 bg-white bg-opacity-20 rounded-2xl p-6 shadow-xl border border-white border-opacity-20">
            <h2 class="text-3xl font-bold text-center text-white mb-6">Analyser un Prompt üîç</h2>
            <p class="text-lg text-center text-white mb-4 opacity-90">
                Collez un prompt pour en comprendre les composants et l'anatomie.
            </p>
            <textarea
                id="analyzePromptInput"
                class="w-full p-4 rounded-xl bg-gray-700 bg-opacity-60 text-white placeholder-gray-300 focus:outline-none focus:ring-4 focus:ring-purple-400 mb-6 h-32 resize-y text-lg"
                placeholder="Ex: Un chevalier en armure brillante, au milieu d'une for√™t sombre et mystique, lumi√®re divine per√ßant les arbres, style fantastique √©pique, rendu cin√©matographique."
            ></textarea>
            <button
                id="analyzeButton"
                class="w-full py-4 px-8 rounded-full bg-purple-600 hover:bg-purple-700 text-white text-2xl font-bold shadow-xl transition-all duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
                Analyser le Prompt üîç
            </button>
            <div id="analysisResultContainer" class="mt-8 p-4 bg-gray-700 bg-opacity-40 rounded-lg text-white hidden">
                <h3 class="text-xl font-semibold mb-4">Analyse du Prompt : </h3>
                <div id="analysisContent">
                    </div>
            </div>
             <div id="analysisErrorMessage" class="mt-8 p-4 bg-red-700 bg-opacity-80 rounded-lg text-center font-medium text-lg text-white shadow-md hidden">
                </div>
        </div>

        <div class="w-full mb-10 bg-white bg-opacity-20 rounded-2xl p-6 shadow-xl border border-white border-opacity-20">
            <h2 class="text-3xl font-bold text-center text-white mb-6">Suggestions de Prompts N√©gatifs üö´</h2>
            <p class="text-lg text-center text-white mb-4 opacity-90">
                Obtenez des suggestions de prompts n√©gatifs pour affiner vos cr√©ations.
            </p>
            <textarea
                id="negativePromptInput"
                class="w-full p-4 rounded-xl bg-gray-700 bg-opacity-60 text-white placeholder-gray-300 focus:outline-none focus:ring-4 focus:ring-orange-400 mb-6 h-32 resize-y text-lg"
                placeholder="Ex: Une personne lisant un livre dans un parc ensoleill√©."
            ></textarea>
            <button
                id="suggestNegativeButton"
                class="w-full py-4 px-8 rounded-full bg-orange-600 hover:bg-orange-700 text-white text-2xl font-bold shadow-xl transition-all duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
                Sugg√©rer des N√©gatifs üö´
            </button>
            <div id="negativeResultContainer" class="mt-8 p-4 bg-gray-700 bg-opacity-40 rounded-lg text-white hidden">
                <h3 class="text-xl font-semibold mb-4">Prompts N√©gatifs Sugg√©r√©s : </h3>
                <ul id="negativeList" class="list-disc list-inside space-y-2">
                    </ul>
            </div>
            <div id="negativeErrorMessage" class="mt-8 p-4 bg-red-700 bg-opacity-80 rounded-lg text-center font-medium text-lg text-white shadow-md hidden">
                </div>
        </div>

        <div class="w-full mb-10 bg-white bg-opacity-20 rounded-2xl p-6 shadow-xl border border-white border-opacity-20">
            <h2 class="text-3xl font-bold text-center text-white mb-6">√âvaluation de Prompt ‚ú®</h2>
            <p class="text-lg text-center text-white mb-4 opacity-90">
                Obtenez une √©valuation constructive de votre prompt et des suggestions d'am√©lioration.
            </p>
            <textarea
                id="evaluatePromptInput"
                class="w-full p-4 rounded-xl bg-gray-700 bg-opacity-60 text-white placeholder-gray-300 focus:outline-none focus:ring-4 focus:ring-teal-400 mb-6 h-32 resize-y text-lg"
                placeholder="Ex: Une ville moderne la nuit."
            ></textarea>
            <button
                id="evaluateButton"
                class="w-full py-4 px-8 rounded-full bg-teal-600 hover:bg-teal-700 text-white text-2xl font-bold shadow-xl transition-all duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
                √âvaluer le Prompt ‚ú®
            </button>
            <div id="evaluationResultContainer" class="mt-8 p-4 bg-gray-700 bg-opacity-40 rounded-lg text-white hidden">
                <h3 class="text-xl font-semibold mb-4">√âvaluation : </h3>
                <div id="evaluationContent">
                    </div>
            </div>
            <div id="evaluationErrorMessage" class="mt-8 p-4 bg-red-700 bg-opacity-80 rounded-lg text-center font-medium text-lg text-white shadow-md hidden">
                </div>
        </div>

        <div class="w-full mb-10 bg-white bg-opacity-20 rounded-2xl p-6 shadow-xl border border-white border-opacity-20">
            <h2 class="text-3xl font-bold text-center text-white mb-6">Explorateur de Styles ‚ú®</h2>
            <p class="text-lg text-center text-white mb-4 opacity-90">
                D√©couvrez les caract√©ristiques d'un style artistique et des exemples de prompts.
            </p>
            <input
                type="text"
                id="styleExplorerInput"
                class="w-full p-4 rounded-xl bg-gray-700 bg-opacity-60 text-white placeholder-gray-300 focus:outline-none focus:ring-4 focus:ring-indigo-400 mb-6 text-lg"
                placeholder="Ex: impressionnisme, cubisme, surr√©alisme"
            />
            <button
                id="exploreStyleButton"
                class="w-full py-4 px-8 rounded-full bg-indigo-600 hover:bg-indigo-700 text-white text-2xl font-bold shadow-xl transition-all duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
                Explorer le Style ‚ú®
            </button>
            <div id="styleResultContainer" class="mt-8 p-4 bg-gray-700 bg-opacity-40 rounded-lg text-white hidden">
                <h3 class="text-xl font-semibold mb-4">D√©tails du Style : </h3>
                <div id="styleContent">
                    </div>
            </div>
            <div id="styleErrorMessage" class="mt-8 p-4 bg-red-700 bg-opacity-80 rounded-lg text-center font-medium text-lg text-white shadow-md hidden">
                </div>
        </div>

        <div class="w-full mb-10 bg-white bg-opacity-20 rounded-2xl p-6 shadow-xl border border-white border-opacity-20">
            <h2 class="text-3xl font-bold text-center text-white mb-6">R√©√©criture de Prompt par Style ‚ú®</h2>
            <p class="text-lg text-center text-white mb-4 opacity-90">
                Entrez un prompt et un style cible pour que l'IA le r√©√©crive.
            </p>
            <textarea
                id="rewritePromptInput"
                class="w-full p-4 rounded-xl bg-gray-700 bg-opacity-60 text-white placeholder-gray-300 focus:outline-none focus:ring-4 focus:ring-yellow-400 mb-4 h-32 resize-y text-lg"
                placeholder="Votre prompt original (ex: un chien dans une prairie)"
            ></textarea>
            <input
                type="text"
                id="targetStyleInput"
                class="w-full p-4 rounded-xl bg-gray-700 bg-opacity-60 text-white placeholder-gray-300 focus:outline-none focus:ring-4 focus:ring-yellow-400 mb-6 text-lg"
                placeholder="Style cible (ex: aquarelle, photographie, peinture √† l'huile)"
            />
            <button
                id="rewritePromptButton"
                class="w-full py-4 px-8 rounded-full bg-yellow-600 hover:bg-yellow-700 text-white text-2xl font-bold shadow-xl transition-all duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
                R√©√©crire le Prompt ‚ú®
            </button>
            <div id="rewriteResultContainer" class="mt-8 p-4 bg-gray-700 bg-opacity-40 rounded-lg text-white hidden">
                <h3 class="text-xl font-semibold mb-4">Prompt R√©√©crit : </h3>
                <div id="rewrittenPromptContent">
                    </div>
            </div>
            <div id="rewriteErrorMessage" class="mt-8 p-4 bg-red-700 bg-opacity-80 rounded-lg text-center font-medium text-lg text-white shadow-md hidden">
                </div>
        </div>

        <div class="w-full mb-10 bg-white bg-opacity-20 rounded-2xl p-6 shadow-xl border border-white border-opacity-20">
            <h2 class="text-3xl font-bold text-center text-white mb-6">Exploration de Concept en Prompts ‚ú®</h2>
            <p class="text-lg text-center text-white mb-4 opacity-90">
                Transformez une id√©e abstraite en plusieurs prompts d'images d√©taill√©s.
            </p>
            <input
                type="text"
                id="conceptInput"
                class="w-full p-4 rounded-xl bg-gray-700 bg-opacity-60 text-white placeholder-gray-300 focus:outline-none focus:ring-4 focus:ring-cyan-400 mb-6 text-lg"
                placeholder="Votre concept (ex: le temps qui passe, la solitude urbaine)"
            />
            <button
                id="exploreConceptButton"
                class="w-full py-4 px-8 rounded-full bg-cyan-600 hover:bg-cyan-700 text-white text-2xl font-bold shadow-xl transition-all duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
                Explorer le Concept ‚ú®
            </button>
            <div id="conceptResultContainer" class="mt-8 p-4 bg-gray-700 bg-opacity-40 rounded-lg text-white hidden">
                <h3 class="text-xl font-semibold mb-4">Prompts issus du Concept : </h3>
                <ul id="conceptPromptsList" class="list-disc list-inside space-y-2">
                    </ul>
            </div>
            <div id="conceptErrorMessage" class="mt-8 p-4 bg-red-700 bg-opacity-80 rounded-lg text-center font-medium text-lg text-white shadow-md hidden">
                </div>
        </div>

        <div class="w-full mb-10 bg-white bg-opacity-20 rounded-2xl p-6 shadow-xl border border-white border-opacity-20">
            <h2 class="text-3xl font-bold text-center text-white mb-6">D√©bogueur de Prompt ‚ú®</h2>
            <p class="text-lg text-center text-white mb-4 opacity-90">
                Identifiez les probl√®mes potentiels dans votre prompt pour de meilleurs r√©sultats.
            </p>
            <textarea
                id="debugPromptInput"
                class="w-full p-4 rounded-xl bg-gray-700 bg-opacity-60 text-white placeholder-gray-300 focus:outline-none focus:ring-4 focus:ring-red-400 mb-6 h-32 resize-y text-lg"
                placeholder="Le prompt √† d√©boguer (ex: un homme heureux et triste en m√™me temps, style photo)"
            ></textarea>
            <button
                id="debugPromptButton"
                class="w-full py-4 px-8 rounded-full bg-red-600 hover:bg-red-700 text-white text-2xl font-bold shadow-xl transition-all duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
                D√©boguer le Prompt ‚ú®
            </button>
            <div id="debugResultContainer" class="mt-8 p-4 bg-gray-700 bg-opacity-40 rounded-lg text-white hidden">
                <h3 class="text-xl font-semibold mb-4">Analyse du D√©bogueur : </h3>
                <div id="debugContent">
                    </div>
            </div>
            <div id="debugErrorMessage" class="mt-8 p-4 bg-red-700 bg-opacity-80 rounded-lg text-center font-medium text-lg text-white shadow-md hidden">
                </div>
        </div>

        <div class="w-full mb-10 bg-white bg-opacity-20 rounded-2xl p-6 shadow-xl border border-white border-opacity-20">
            <h2 class="text-3xl font-bold text-center text-white mb-6">Extension de Prompt ‚ú®</h2>
            <p class="text-lg text-center text-white mb-4 opacity-90">
                D√©veloppez un prompt simple en une description riche et d√©taill√©e.
            </p>
            <textarea
                id="extendPromptInput"
                class="w-full p-4 rounded-xl bg-gray-700 bg-opacity-60 text-white placeholder-gray-300 focus:outline-none focus:ring-4 focus:ring-lime-400 mb-6 h-32 resize-y text-lg"
                placeholder="Votre prompt court (ex: un chien qui court)"
            ></textarea>
            <button
                id="extendPromptButton"
                class="w-full py-4 px-8 rounded-full bg-lime-600 hover:bg-lime-700 text-white text-2xl font-bold shadow-xl transition-all duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
                √âtendre le Prompt ‚ú®
            </button>
            <div id="extendResultContainer" class="mt-8 p-4 bg-gray-700 bg-opacity-40 rounded-lg text-white hidden">
                <h3 class="text-xl font-semibold mb-4">Prompt √âtendu : </h3>
                <div id="extendedContent">
                    </div>
            </div>
            <div id="extendErrorMessage" class="mt-8 p-4 bg-red-700 bg-opacity-80 rounded-lg text-center font-medium text-lg text-white shadow-md hidden">
                </div>
        </div>
    </div>

    <script type="module">
        // Firebase imports
        import { initializeApp } from "./firebase-libs/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "./firebase-libs/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "./firebase-libs/firebase-firestore.js";

        // Firebase variables
        let app;
        let db;
        let auth;
        let currentUserId = null;

        // DOM Elements
        const ideaThemeInput = document.getElementById('ideaThemeInput');
        const generateIdeasButton = document.getElementById('generateIdeasButton');
        const ideasResultContainer = document.getElementById('ideasResultContainer');
        const ideasList = document.getElementById('ideasList');
        const ideasErrorMessage = document.getElementById('ideasErrorMessage');

        const analyzePromptInput = document.getElementById('analyzePromptInput');
        const analyzeButton = document.getElementById('analyzeButton');
        const analysisResultContainer = document.getElementById('analysisResultContainer');
        const analysisContent = document.getElementById('analysisContent');
        const analysisErrorMessage = document.getElementById('analysisErrorMessage');

        const negativePromptInput = document.getElementById('negativePromptInput');
        const suggestNegativeButton = document.getElementById('suggestNegativeButton');
        const negativeResultContainer = document.getElementById('negativeResultContainer');
        const negativeList = document.getElementById('negativeList');
        const negativeErrorMessage = document.getElementById('negativeErrorMessage');

        const evaluatePromptInput = document.getElementById('evaluatePromptInput');
        const evaluateButton = document.getElementById('evaluateButton');
        const evaluationResultContainer = document.getElementById('evaluationResultContainer');
        const evaluationContent = document.getElementById('evaluationContent');
        const evaluationErrorMessage = document.getElementById('evaluationErrorMessage');

        const styleExplorerInput = document.getElementById('styleExplorerInput');
        const exploreStyleButton = document.getElementById('exploreStyleButton');
        const styleResultContainer = document.getElementById('styleResultContainer');
        const styleContent = document.getElementById('styleContent');
        const styleErrorMessage = document.getElementById('styleErrorMessage');

        const rewritePromptInput = document.getElementById('rewritePromptInput');
        const targetStyleInput = document.getElementById('targetStyleInput');
        const rewritePromptButton = document.getElementById('rewritePromptButton');
        const rewriteResultContainer = document.getElementById('rewriteResultContainer');
        const rewrittenPromptContent = document.getElementById('rewrittenPromptContent');
        const rewriteErrorMessage = document.getElementById('rewriteErrorMessage');

        const conceptInput = document.getElementById('conceptInput');
        const exploreConceptButton = document.getElementById('exploreConceptButton');
        const conceptResultContainer = document.getElementById('conceptResultContainer');
        const conceptPromptsList = document.getElementById('conceptPromptsList');
        const conceptErrorMessage = document.getElementById('conceptErrorMessage');

        const debugPromptInput = document.getElementById('debugPromptInput');
        const debugPromptButton = document.getElementById('debugPromptButton');
        const debugResultContainer = document.getElementById('debugResultContainer');
        const debugContent = document.getElementById('debugContent');
        const debugErrorMessage = document.getElementById('debugErrorMessage');

        const extendPromptInput = document.getElementById('extendPromptInput');
        const extendPromptButton = document.getElementById('extendPromptButton');
        const extendResultContainer = document.getElementById('extendResultContainer');
        const extendedContent = document.getElementById('extendedContent');
        const extendErrorMessage = document.getElementById('extendErrorMessage');


        // Utility Functions (shared)
        function displayError(message, targetDiv) {
            targetDiv.textContent = message;
            targetDiv.classList.remove('hidden');
        }

        function hideError(targetDiv) {
            targetDiv.classList.add('hidden');
            targetDiv.textContent = '';
        }

        function showLoading(button, originalText) {
            button.disabled = true;
            button.dataset.originalText = originalText;
            button.innerHTML = `
                <svg class="animate-spin -ml-1 mr-3 h-6 w-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                ${originalText.includes('G√©n√©rer') ? 'G√©n√©ration en cours...' : originalText.includes('Am√©liorer') ? 'Am√©lioration en cours...' : originalText.includes('Analyser') ? 'Analyse en cours...' : originalText.includes('Sugg√©rer') ? 'Suggestions en cours...' : originalText.includes('√âvaluer') ? '√âvaluation en cours...' : originalText.includes('Explorer') ? 'Exploration en cours...' : originalText.includes('R√©√©crire') ? 'R√©√©criture en cours...' : originalText.includes('D√©boguer') ? 'D√©bogage en cours...' : originalText.includes('√âtendre') ? 'Extension en cours...' : 'Chargement...'}
            `;
        }

        function hideLoading(button) {
            button.disabled = false;
            button.textContent = button.dataset.originalText;
        }

        // Firebase Initialization and Authentication
        window.onload = async () => {
            try {
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        console.log("Authenticated as:", currentUserId);
                    } else {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            try {
                                await signInWithCustomToken(auth, __initial_auth_token);
                            } catch (error) {
                                console.error("Error signing in with custom token:", error);
                                await signInAnonymously(auth);
                            }
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                });
            } catch (error) {
                console.error("Error initializing Firebase:", error);
            }
        };

        // Function to increment usage stats
        async function incrementStat(statName) {
            if (!currentUserId || !db) {
                console.warn("Cannot increment stat: user not authenticated or db not initialized.");
                return;
            }
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const statsDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/usageStats/counts`);
            try {
                await setDoc(statsDocRef, { [statName]: increment(1) }, { merge: true });
            } catch (error) {
                console.error(`Error incrementing ${statName}:`, error);
            }
        }


        // Generate Ideas (Gemini API)
        generateIdeasButton.addEventListener('click', async () => {
            const theme = ideaThemeInput.value.trim();
            if (!theme) { displayError("Veuillez entrer un th√®me pour g√©n√©rer des id√©es.", ideasErrorMessage); return; }
            hideError(ideasErrorMessage); ideasResultContainer.classList.add('hidden'); ideasList.innerHTML = ''; showLoading(generateIdeasButton, generateIdeasButton.textContent);
            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `G√©n√®re 5 id√©es de prompts cr√©atifs et uniques pour la g√©n√©ration d'images bas√©es sur le th√®me suivant : "${theme}". Chaque id√©e doit √™tre un prompt complet, direct et descriptif, incluant des √©l√©ments de style, d'√©clairage ou de composition. Pr√©sente la r√©ponse sous forme de liste num√©rot√©e.` }] });
                const payload = { contents: chatHistory }; const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(`Erreur LLM: ${response.status} - ${errorData.error.message || 'Quelque chose a mal tourn√©'}`); }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                    const ideasText = result.candidates[0].content.parts[0].text.trim();
                    const ideasArray = ideasText.split('\n').filter(line => line.trim().length > 0);
                    ideasArray.forEach(idea => { const li = document.createElement('li'); li.textContent = idea.replace(/^\d+\.\s*/, ''); ideasList.appendChild(li); });
                    ideasResultContainer.classList.remove('hidden');
                } else { displayError("Aucune id√©e g√©n√©r√©e. Veuillez r√©essayer avec un th√®me diff√©rent.", ideasErrorMessage); }
            } catch (error) { console.error("Erreur lors de la g√©n√©ration d'id√©es:", error); displayError(`√âchec de la g√©n√©ration d'id√©es: ${error.message}", ideasErrorMessage); }
            finally { hideLoading(generateIdeasButton); }
            await incrementStat('ideaGenerations');
        });

        // Analyze Prompt (Gemini API)
        analyzeButton.addEventListener('click', async () => {
            const promptToAnalyze = analyzePromptInput.value.trim();
            if (!promptToAnalyze) { displayError("Veuillez entrer un prompt √† analyser.", analysisErrorMessage); return; }
            hideError(analysisErrorMessage); analysisResultContainer.classList.add('hidden'); analysisContent.innerHTML = ''; showLoading(analyzeButton, analyzeButton.textContent);
            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `Analyse le prompt suivant pour la g√©n√©ration d'images. D√©compose-le en ses composants cl√©s comme le sujet, l'action/contexte, le style artistique, l'√©clairage, la composition, l'ambiance, et d'autres d√©tails importants. Pr√©sente l'analyse de mani√®re claire et structur√©e, comme une liste ou des paragraphes distincts pour chaque composant. Voici le prompt √† analyser: "${promptToAnalyze}"` }] });
                const payload = { contents: chatHistory }; const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(`Erreur LLM: ${response.status} - ${errorData.error.message || 'Quelque chose a mal tourn√©'}`); }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                    const analysisText = result.candidates[0].content.parts[0].text;
                    analysisContent.innerHTML = analysisText.replace(/\n\s*\n/g, '</p><p>');
                    if (!analysisContent.innerHTML.startsWith('<p>')) { analysisContent.innerHTML = '<p>' + analysisContent.innerHTML; }
                    if (!analysisContent.innerHTML.endsWith('</p>')) { analysisContent.innerHTML = analysisContent.innerHTML + '</p>'; }
                    analysisResultContainer.classList.remove('hidden');
                } else { displayError("Impossible d'analyser le prompt. Veuillez r√©essayer.", analysisErrorMessage); }
            } catch (error) { console.error("Erreur lors de l'analyse du prompt:", error); displayError(`√âchec de l'analyse: ${error.message}", analysisErrorMessage); }
            finally { hideLoading(analyzeButton); }
            await incrementStat('promptAnalyses');
        });

        // Suggest Negative Prompts (Gemini API)
        suggestNegativeButton.addEventListener('click', async () => {
            const positivePrompt = negativePromptInput.value.trim();
            if (!positivePrompt) { displayError("Veuillez entrer un prompt positif pour obtenir des suggestions n√©gatives.", negativeErrorMessage); return; }
            hideError(negativeErrorMessage); negativeResultContainer.classList.add('hidden'); negativeList.innerHTML = ''; showLoading(suggestNegativeButton, suggestNegativeButton.textContent);
            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `Pour le prompt positif suivant : "${positivePrompt}", sugg√®re 3 √† 5 prompts n√©gatifs courants qui pourraient aider √† √©viter les r√©sultats ind√©sirables ou les artefacts, ou √† am√©liorer la qualit√© g√©n√©rale de l'image. Chaque suggestion doit √™tre un terme ou une courte phrase, et la r√©ponse doit √™tre une liste num√©rot√©e de ces prompts n√©gatifs. Sois concis.` }] });
                const payload = { contents: chatHistory }; const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(`Erreur LLM: ${response.status} - ${errorData.error.message || 'Quelque chose a mal tourn√©'}`); }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                    const negativePromptsText = result.candidates[0].content.parts[0].text.trim();
                    const negativePromptsArray = negativePromptsText.split('\n').filter(line => line.trim().length > 0);
                    negativePromptsArray.forEach(prompt => { const li = document.createElement('li'); li.textContent = prompt.replace(/^\d+\.\s*/, ''); negativeList.appendChild(li); });
                    negativeResultContainer.classList.remove('hidden');
                } else { displayError("Aucune suggestion de prompt n√©gatif. Veuillez r√©essayer.", negativeErrorMessage); }
            } catch (error) { console.error("Erreur lors de la suggestion de prompts n√©gatifs:", error); displayError(`√âchec de la suggestion: ${error.message}", negativeErrorMessage); }
            finally { hideLoading(suggestNegativeButton); }
            await incrementStat('negativePromptSuggestions');
        });

        // Evaluate Prompt (Gemini API)
        evaluateButton.addEventListener('click', async () => {
            const promptToEvaluate = evaluatePromptInput.value.trim();
            if (!promptToEvaluate) { displayError("Veuillez entrer un prompt √† √©valuer.", evaluationErrorMessage); return; }
            hideError(evaluationErrorMessage); evaluationResultContainer.classList.add('hidden'); evaluationContent.innerHTML = ''; showLoading(evaluateButton, evaluateButton.textContent);
            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `√âvalue le prompt suivant pour la g√©n√©ration d'images. Donne une note (par exemple, sur 10) si possible, et explique les points forts et les points √† am√©liorer pour obtenir une image de meilleure qualit√©. Sois constructif et concis. Voici le prompt: "${promptToEvaluate}"` }] });
                const payload = { contents: chatHistory }; const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(`Erreur LLM: ${response.status} - ${errorData.error.message || 'Quelque chose a mal tourn√©'}`); }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                    const evaluationText = result.candidates[0].content.parts[0].text;
                    evaluationContent.innerHTML = evaluationText.replace(/\n\s*\n/g, '</p><p>');
                    if (!evaluationContent.innerHTML.startsWith('<p>')) { evaluationContent.innerHTML = '<p>' + evaluationContent.innerHTML; }
                    if (!evaluationContent.innerHTML.endsWith('</p>')) { evaluationContent.innerHTML = evaluationContent.innerHTML + '</p>'; }
                    evaluationResultContainer.classList.remove('hidden');
                } else { displayError("Impossible d'√©valuer le prompt. Veuillez r√©essayer.", evaluationErrorMessage); }
            } catch (error) { console.error("Erreur lors de l'√©valuation du prompt:", error); displayError(`√âchec de l'√©valuation: ${error.message}", evaluationErrorMessage); }
            finally { hideLoading(evaluateButton); }
            await incrementStat('promptEvaluations');
        });

        // Explore Style (Gemini API)
        exploreStyleButton.addEventListener('click', async () => {
            const styleName = styleExplorerInput.value.trim();
            if (!styleName) { displayError("Veuillez entrer un nom de style √† explorer.", styleErrorMessage); return; }
            hideError(styleErrorMessage); styleResultContainer.classList.add('hidden'); styleContent.innerHTML = ''; showLoading(exploreStyleButton, exploreStyleButton.textContent);
            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `D√©cris bri√®vement le style artistique "${styleName}" et donne 2-3 exemples de fragments de prompts pour la g√©n√©ration d'images qui int√®grent ce style. Le format doit √™tre : Description du style, puis une liste √† puces des exemples de prompts. Sois concis.` }] });
                const payload = { contents: chatHistory }; const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(`Erreur LLM: ${response.status} - ${errorData.error.message || 'Quelque chose a mal tourn√©'}`); }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                    const styleText = result.candidates[0].content.parts[0].text;
                    styleContent.innerHTML = styleText.replace(/\n\s*-\s*/g, '</li><li>').replace(/^\s*-\s*/, '<li>') + '</li>';
                    if (!styleContent.innerHTML.startsWith('<p>')) { styleContent.innerHTML = '<p>' + styleContent.innerHTML; }
                    if (!styleContent.innerHTML.endsWith('</p>') && !styleContent.innerHTML.endsWith('</li>')) { styleContent.innerHTML = styleContent.innerHTML + '</p>'; } else if (styleContent.innerHTML.endsWith('</li>')) { styleContent.innerHTML = '<ul>' + styleContent.innerHTML + '</ul>'; }
                    let finalHtml = styleContent.innerHTML;
                    if (finalHtml.startsWith('<p>Description du style:')) { finalHtml = finalHtml.replace('<p>Description du style:', '<p>'); }
                    if (finalHtml.startsWith('<p>Description du style :')) { finalHtml = finalHtml.replace('<p>Description du style :', '<p>'); }
                    const ulStartIndex = finalHtml.indexOf('<ul>');
                    if (ulStartIndex > 0 && finalHtml.substring(0, ulStartIndex).includes('</p>')) {
                        const lastPBeforeUl = finalHtml.lastIndexOf('</p>', ulStartIndex);
                        if (lastPBeforeUl !== -1) { finalHtml = finalHtml.substring(0, lastPBeforeUl + 4) + '<br/>' + finalHtml.substring(lastPBeforeUl + 4); }
                    }
                    styleContent.innerHTML = finalHtml;
                    styleResultContainer.classList.remove('hidden');
                } else { displayError("Impossible d'explorer ce style. Veuillez r√©essayer.", styleErrorMessage); }
            } catch (error) { console.error("Erreur lors de l'exploration du style:", error); displayError(`√âchec de l'exploration: ${error.message}", styleErrorMessage); }
            finally { hideLoading(exploreStyleButton); }
            await incrementStat('styleExplorations');
        });

        // Rewrite Prompt by Style/Model (Gemini API)
        rewritePromptButton.addEventListener('click', async () => {
            const originalPrompt = rewritePromptInput.value.trim();
            const targetStyle = targetStyleInput.value.trim();

            if (!originalPrompt || !targetStyle) {
                displayError("Veuillez entrer le prompt original et le style cible.", rewriteErrorMessage);
                return;
            }

            hideError(rewriteErrorMessage);
            rewriteResultContainer.classList.add('hidden');
            rewrittenPromptContent.innerHTML = '';
            showLoading(rewritePromptButton, rewritePromptButton.textContent);

            try {
                let chatHistory = [];
                chatHistory.push({
                    role: "user",
                    parts: [{
                        text: `R√©√©cris le prompt suivant pour la g√©n√©ration d'images afin qu'il corresponde au style artistique ou au mod√®le suivant : "${targetStyle}". Assure-toi que le nouveau prompt est d√©taill√©, cr√©atif et pr√™t √† l'emploi. Le prompt original est : "${originalPrompt}".`
                    }]
                });

                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Erreur LLM: ${response.status} - ${errorData.error.message || 'Quelque chose a mal tourn√©'}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const rewrittenPrompt = result.candidates[0].content.parts[0].text.trim();
                    rewrittenPromptContent.textContent = rewrittenPrompt;
                    rewriteResultContainer.classList.remove('hidden');
                } else {
                    displayError("Impossible de r√©√©crire le prompt. Veuillez r√©essayer.", rewriteErrorMessage);
                }

            } catch (error) {
                console.error("Erreur lors de la r√©√©criture du prompt:", error);
                displayError(`√âchec de la r√©√©criture: ${error.message}", rewriteErrorMessage);
            } finally {
                hideLoading(rewritePromptButton);
            }
            await incrementStat('promptRewrites'); // Increment stat for this new feature
        });

        // Explore Concept in Prompts (Gemini API)
        exploreConceptButton.addEventListener('click', async () => {
            const concept = conceptInput.value.trim();

            if (!concept) {
                displayError("Veuillez entrer un concept √† explorer.", conceptErrorMessage);
                return;
            }

            hideError(conceptErrorMessage);
            conceptResultContainer.classList.add('hidden');
            conceptPromptsList.innerHTML = '';
            showLoading(exploreConceptButton, exploreConceptButton.textContent);

            try {
                let chatHistory = [];
                chatHistory.push({
                    role: "user",
                    parts: [{
                        text: `Transforme le concept suivant : "${concept}", en 3 √† 5 prompts d'images cr√©atifs et d√©taill√©s. Chaque prompt doit √™tre unique, inclure des √©l√©ments de style, de composition, d'√©clairage, et d'ambiance, et √™tre pr√™t √† l'emploi par un mod√®le de g√©n√©ration d'images. Pr√©sente la r√©ponse sous forme de liste num√©rot√©e.`
                    }]
                });

                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Erreur LLM: ${response.status} - ${errorData.error.message || 'Quelque chose a mal tourn√©'}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const conceptPromptsText = result.candidates[0].content.parts[0].text.trim();
                    const conceptPromptsArray = conceptPromptsText.split('\n').filter(line => line.trim().length > 0);
                    conceptPromptsArray.forEach(prompt => {
                        const li = document.createElement('li');
                        li.textContent = prompt.replace(/^\d+\.\s*/, '');
                        conceptPromptsList.appendChild(li);
                    });
                    conceptResultContainer.classList.remove('hidden');
                } else {
                    displayError("Impossible d'explorer le concept. Veuillez r√©essayer.", conceptErrorMessage);
                }

            } catch (error) {
                console.error("Erreur lors de l'exploration du concept:", error);
                displayError(`√âchec de l'exploration: ${error.message}", conceptErrorMessage);
            } finally {
                hideLoading(exploreConceptButton);
            }
            await incrementStat('conceptExplorations'); // Increment stat for this new feature
        });

        // D√©bogueur de Prompt (Gemini API)
        debugPromptButton.addEventListener('click', async () => {
            const promptToDebug = debugPromptInput.value.trim();

            if (!promptToDebug) {
                displayError("Veuillez entrer un prompt √† d√©boguer.", debugErrorMessage);
                return;
            }

            hideError(debugErrorMessage);
            debugResultContainer.classList.add('hidden');
            debugContent.innerHTML = '';
            showLoading(debugPromptButton, debugPromptButton.textContent);

            try {
                let chatHistory = [];
                chatHistory.push({
                    role: "user",
                    parts: [{
                        text: `Analyse le prompt suivant pour la g√©n√©ration d'images. Identifie les probl√®mes potentiels tels que les ambigu√Øt√©s, les informations manquantes, les contradictions ou les termes qui pourraient conduire √† des r√©sultats ind√©sirables. Sugg√®re des am√©liorations sp√©cifiques. Pr√©sente l'analyse de mani√®re claire et structur√©e. Voici le prompt √† d√©boguer: "${promptToDebug}"`
                    }]
                });

                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Erreur LLM: ${response.status} - ${errorData.error.message || 'Quelque chose a mal tourn√©'}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const debugAnalysis = result.candidates[0].content.parts[0].text;
                    debugContent.innerHTML = debugAnalysis.replace(/\n\s*\n/g, '</p><p>');
                    if (!debugContent.innerHTML.startsWith('<p>')) {
                        debugContent.innerHTML = '<p>' + debugContent.innerHTML;
                    }
                    if (!debugContent.innerHTML.endsWith('</p>')) {
                        debugContent.innerHTML = debugContent.innerHTML + '</p>';
                    }
                    debugResultContainer.classList.remove('hidden');
                } else {
                    displayError("Impossible de d√©boguer le prompt. Veuillez r√©essayer.", debugErrorMessage);
                }

            } catch (error) {
                console.error("Erreur lors du d√©bogage du prompt:", error);
                displayError(`√âchec du d√©bogage: ${error.message}", debugErrorMessage);
            } finally {
                hideLoading(debugPromptButton);
            }
            await incrementStat('promptDebugging'); // Incr√©menter la nouvelle statistique
        });

        // Extension de Prompt (Gemini API)
        extendPromptButton.addEventListener('click', async () => {
            const shortPrompt = extendPromptInput.value.trim();

            if (!shortPrompt) {
                displayError("Veuillez entrer un prompt court √† √©tendre.", extendErrorMessage);
                return;
            }

            hideError(extendErrorMessage);
            extendResultContainer.classList.add('hidden');
            extendedContent.innerHTML = '';
            showLoading(extendPromptButton, extendPromptButton.textContent);

            try {
                let chatHistory = [];
                chatHistory.push({
                    role: "user",
                    parts: [{
                        text: `Prends le prompt d'image suivant : "${shortPrompt}", et √©tends-le en un prompt beaucoup plus d√©taill√© et riche. Ajoute des informations sur le contexte, l'√©clairage, la composition, l'ambiance, les d√©tails sp√©cifiques des √©l√©ments, et le style artistique. Le prompt final doit √™tre pr√™t √† l'emploi par un mod√®le de g√©n√©ration d'images, avec une longueur significative.`
                    }]
                });

                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Erreur LLM: ${response.status} - ${errorData.error.message || 'Quelque chose a mal tourn√©'}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const extendedPrompt = result.candidates[0].content.parts[0].text.trim();
                    extendedContent.textContent = extendedPrompt;
                    extendResultContainer.classList.remove('hidden');
                } else {
                    displayError("Impossible d'√©tendre le prompt. Veuillez r√©essayer.", extendErrorMessage);
                }

            } catch (error) {
                console.error("Erreur lors de l'extension du prompt:", error);
                displayError(`√âchec de l'extension: ${error.message}", extendErrorMessage);
            } finally {
                hideLoading(extendPromptButton);
            }
            await incrementStat('promptExtensions'); // Incr√©menter la nouvelle statistique
        });
    </script>
</body>
</html>
